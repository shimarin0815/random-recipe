<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ãƒ©ãƒ³ãƒ€ãƒ ãƒ¬ã‚·ãƒ”ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
  <meta name="description" content="æ‰‹æŒã¡ã®ææ–™ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã§ç°¡å˜ãƒ¬ã‚·ãƒ”ã‚’ææ¡ˆã€‚ãƒ¦ãƒ¼ãƒ¢ã‚¢ä»˜ãã§æ–™ç†ã‚¿ã‚¤ãƒ ã‚’æ¥½ã—ãï¼"/>
  <style>
    :root{
      --bg: 255 255 255;
      --fg: 22 24 29;
      --muted: 110 114 120;
      --accent: 99 102 241; /* indigo */
      --accent-2: 16 185 129; /* emerald */
      --card: 255 255 255;
      --glass: 255 255 255 / .55;
      color-scheme: light dark;
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg: 12 14 18;
        --fg: 233 234 239;
        --muted: 160 166 176;
        --card: 22 24 29;
        --glass: 22 24 29 / .55;
      }
    }
    *{ box-sizing: border-box; }
    html,body{ height:100%; }
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans JP, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, Arial, sans-serif;
      color: rgb(var(--fg));
      background:
        radial-gradient(1200px 600px at 10% 10%, rgba(var(--accent),.08), transparent 60%),
        radial-gradient(1200px 600px at 90% 0%, rgba(var(--accent-2),.08), transparent 60%),
        linear-gradient(180deg, rgba(var(--bg),1), rgba(var(--bg),1));
    }
    header{
      position:sticky; top:0; z-index:5;
      backdrop-filter: blur(8px);
      background: linear-gradient(180deg, rgba(var(--glass)), rgba(var(--glass), .65));
      border-bottom: 1px solid rgba(var(--fg), .06);
    }
    .wrap{ max-width: 980px; margin: 0 auto; padding: 18px 20px; }
    .title{ display:flex; gap:12px; align-items:center; }
    .logo{ width:38px; height:38px; border-radius:14px; display:grid; place-items:center; font-size:20px;
      background: linear-gradient(135deg, rgba(var(--accent),.9), rgba(var(--accent-2),.9)); color:white; box-shadow: 0 8px 24px rgba(var(--accent), .25);
    }
    h1{ font-size: clamp(22px, 3.2vw, 34px); margin:0; letter-spacing:.02em; }
    .sub{ color: rgb(var(--muted)); font-size: 14px; }

    main{ padding: 24px 20px 72px; }

    .card{
      background: linear-gradient(180deg, rgba(var(--card), .65), rgba(var(--card), .8));
      backdrop-filter: blur(10px);
      border:1px solid rgba(var(--fg), .08);
      border-radius: 20px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,.08);
    }
    .grid{ display:grid; grid-template-columns: 1.1fr .9fr; gap:20px; }
    @media (max-width: 920px){ .grid{ grid-template-columns: 1fr; } }

    .section-title{ font-weight:700; margin: 0 0 10px; font-size: 15px; letter-spacing:.04em; text-transform: uppercase; color: rgb(var(--muted)); }

    /* Input chips */
    .chip-box{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; padding: 10px; border:1px dashed rgba(var(--fg), .15); border-radius: 16px; background: rgba(var(--card), .5); }
    .chip{ display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius: 999px; background: rgba(var(--accent), .08); border:1px solid rgba(var(--accent), .18); }
    .chip .x{ width:18px; height:18px; border:none; border-radius:999px; display:grid; place-items:center; background: rgba(var(--accent), .2); color:white; cursor:pointer; }
    .chip .x:hover{ filter: brightness(1.05); }

    .input{ flex:1; min-width: 180px; border:none; outline:none; padding:10px 12px; background: transparent; color: rgb(var(--fg)); font-size:16px; }
    .helper{ font-size:12px; color: rgb(var(--muted)); margin-top: 6px; }

    .quick{ display:flex; flex-wrap:wrap; gap:8px; }
    .quick button{ padding:7px 12px; border-radius:999px; border:1px solid rgba(var(--fg), .12); background: rgba(var(--fg), .04); cursor:pointer; }
    .quick button:hover{ transform: translateY(-1px); }

    .controls{ display:flex; flex-wrap:wrap; gap:12px; align-items:center; justify-content: space-between; margin-top:14px; }
    .left, .right{ display:flex; flex-wrap:wrap; gap:12px; align-items:center; }
    .btn{ border:none; cursor:pointer; padding:12px 16px; border-radius: 14px; font-weight:700; letter-spacing:.02em; background: linear-gradient(135deg, rgba(var(--accent),.95), rgba(var(--accent-2),.95)); color:white; box-shadow: 0 10px 22px rgba(var(--accent), .25); }
    .btn.secondary{ background: rgba(var(--fg), .06); color: rgb(var(--fg)); box-shadow:none; border:1px solid rgba(var(--fg), .12); }
    .btn.ghost{ background: transparent; color: rgb(var(--fg)); border:1px dashed rgba(var(--fg), .18); box-shadow:none; }
    .btn:active{ transform: translateY(1px); }

    .slider{ appearance:none; height:6px; border-radius:999px; background: rgba(var(--fg), .12); outline:none; width:180px; }
    .slider::-webkit-slider-thumb{ -webkit-appearance:none; appearance:none; width:20px; height:20px; border-radius:50%; background: linear-gradient(135deg, rgba(var(--accent),1), rgba(var(--accent-2),1)); box-shadow: 0 4px 10px rgba(0,0,0,.2);
      border: 2px solid white; }

    /* Result */
    .result{ display:none; margin-top: 18px; }
    .recipe-card{ position:relative; overflow:hidden; }
    .badge{ position:absolute; top:16px; right:16px; padding:6px 10px; border-radius:999px; font-size:12px; background: rgba(var(--accent), .15); border:1px solid rgba(var(--accent), .3); }
    .recipe-title{ font-size: clamp(18px, 2.8vw, 26px); margin: 6px 0 10px; }
    .used{ color: rgb(var(--muted)); font-size: 14px; }
    .steps{ margin: 12px 0 0; padding:0 0 0 22px; }
    .steps li{ margin: 6px 0; }
    .comment{ margin-top: 10px; font-weight:700; }
    .fail{ margin-top: 8px; color: rgb(var(--muted)); font-size: 14px; }

    .footer{ margin-top: 26px; font-size: 12px; color: rgb(var(--muted)); text-align:center; }

    /* Confetti canvas */
    #confetti{ position: fixed; inset:0; pointer-events: none; z-index: 10; }
  </style>
</head>
<body>
  <canvas id="confetti"></canvas>
  <header>
    <div class="wrap title">
      <div class="logo" aria-hidden="true">ğŸ³</div>
      <div>
        <h1>ãƒ©ãƒ³ãƒ€ãƒ ãƒ¬ã‚·ãƒ”ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
        <div class="sub">ææ–™ã‚’å…¥ã‚Œã‚‹ã ã‘ã€‚<strong>é‹ã¨ãƒãƒª</strong>ã§ä»Šæ—¥ã®ä¸€çš¿ã€ã§ãã¡ã‚ƒã„ã¾ã™ã€‚</div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div class="grid">
      <section class="card">
        <p class="section-title">ææ–™ã‚’å…¥åŠ›</p>
        <div class="chip-box" id="chipBox" aria-live="polite">
          <input id="ingredientInput" class="input" type="text" placeholder="ä¾‹: åµ, ãƒˆãƒãƒˆ, ãƒãƒ¼ã‚º ãªã©ã€‚Enterã§è¿½åŠ " aria-label="ææ–™ã‚’å…¥åŠ›"/>
        </div>
        <div class="helper">ãƒ’ãƒ³ãƒˆ: ã‚«ãƒ³ãƒï¼ˆ,ï¼‰ã‚„Enterã§è¿½åŠ ã€‚ã„ã‚‰ãªã„ãƒãƒƒãƒ—ã¯Ã—ã§æ¶ˆã›ã¾ã™ã€‚</div>

        <div style="height:10px"></div>
        <p class="section-title">ã‚ˆãä½¿ã†ææ–™ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§è¿½åŠ ï¼‰</p>
        <div class="quick" id="quick"></div>

        <div class="controls">
          <div class="left">
            <button class="btn" id="gen">ãƒ¬ã‚·ãƒ”ç”Ÿæˆ ğŸ²</button>
            <button class="btn secondary" id="reset">ãƒªã‚»ãƒƒãƒˆ</button>
            <button class="btn ghost" id="randomFill">ãŠã¾ã‹ã›ã§ææ–™è¿½åŠ </button>
          </div>
          <div class="right" title="æ‰‹é †ã‚’ã©ã“ã¾ã§è©³ã—ãã™ã‚‹ã‹">
            <span style="font-size:12px;color:rgb(var(--muted));">ã‚„ã‚‹æ°—ãƒ¬ãƒ™ãƒ«</span>
            <input type="range" min="1" max="3" value="2" step="1" id="effort" class="slider"/>
            <span id="effortFace" aria-hidden="true">ğŸ’ª</span>
          </div>
        </div>
      </section>

      <section class="card recipe-card">
        <span class="badge" id="badge">ã‹ã‚“ãŸã‚“</span>
        <h2 class="recipe-title" id="recipeTitle">ã¾ã ä½•ã‚‚æ±ºã¾ã£ã¦ã„ã¾ã›ã‚“</h2>
        <div class="used" id="used">ææ–™ã‚’å…¥ã‚Œã¦ã€Œãƒ¬ã‚·ãƒ”ç”Ÿæˆã€ã‚’æŠ¼ã—ã¦ã­ã€‚</div>
        <ol class="steps" id="steps"></ol>
        <div class="comment" id="comment"></div>
        <div class="fail" id="fail"></div>
        <div class="controls" style="margin-top:14px;">
          <div class="left">
            <button class="btn secondary" id="again">ã‚‚ã†ä¸€å›ï¼</button>
            <button class="btn ghost" id="copy">ã‚³ãƒ”ãƒ¼</button>
          </div>
          <div class="right">
            <small class="sub">â€»å®‰å…¨ç¬¬ä¸€ï¼šé£Ÿæã¯ç«ã‚’é€šã—ã™ããšã€ã§ã‚‚ã—ã£ã‹ã‚Šã€‚</small>
          </div>
        </div>
      </section>
    </div>

    <p class="footer">Â© ãƒ©ãƒ³ãƒ€ãƒ ãƒ¬ã‚·ãƒ”ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ â€“ å¤±æ•—ã—ã¦ã‚‚OKã€‚æœ€æ‚ªã€<em>ãƒ”ã‚¶å±‹ã«GO</em>ã€‚</p>
  </main>

  <script>
    // ====== ãƒ‡ãƒ¼ã‚¿ ======
    const COMMON_ING = [
      'åµ','ãƒˆãƒãƒˆ','ç‰ã­ã','ã»ã†ã‚Œã‚“è‰','ãã®ã“','ã˜ã‚ƒãŒã„ã‚‚','ã«ã‚“ã˜ã‚“','ã‚­ãƒ£ãƒ™ãƒ„','ãƒ”ãƒ¼ãƒãƒ³','ã­ã',
      'ã”ã¯ã‚“','ãƒ‘ã‚¹ã‚¿','é£Ÿãƒ‘ãƒ³',
      'ãƒ„ãƒŠç¼¶','è±†è…','é¶ã‚€ã­','ãƒ™ãƒ¼ã‚³ãƒ³','ãƒãƒ ','ã‚¦ã‚¤ãƒ³ãƒŠãƒ¼',
      'ãƒãƒ¼ã‚º','ã®ã‚Š','ãƒãƒ¨ãƒãƒ¼ã‚º','ã‚±ãƒãƒ£ãƒƒãƒ—','ãƒã‚¿ãƒ¼','ã‚ªãƒªãƒ¼ãƒ–ã‚ªã‚¤ãƒ«'
    ];

    const HUMOR = [
      'ã“ã‚Œã§ã‚·ã‚§ãƒ•æ°—åˆ†ï¼','ã¾ã‚‹ã§TVã®ãƒ¯ãƒ³ã‚³ãƒ¼ãƒŠãƒ¼ã€‚','å‘³è¦‹ã¯2å›ã¾ã§ï¼ˆ1å›ç›®ã¯ç¢ºèªã€2å›ç›®ã¯ã”è¤’ç¾ï¼‰ã€‚',
      'æ´—ã„ç‰©ã‚’æ¸›ã‚‰ã›ãŸäººãŒçœŸã®å‹è€…ã€‚','ç››ã‚Šã¤ã‘ã§8å‰²å‹ã¦ã‚‹èª¬ã€‚','BGMã¯è‡ªç”±ã€‚è¸Šã£ã¦ã‚‚OKã€‚'
    ];

    const FAIL_JOKES = [
      'ç„¦ã’ãŸã‚‰ãƒ”ã‚¶å±‹ã«GOã€‚','å‘³ãŒè–„ã‹ã£ãŸã‚‰ã€Œä¸Šå“ã€ã¨è¨€ã„å¼µã‚ã†ã€‚',
      'ã—ã‚‡ã£ã±ã‹ã£ãŸã‚‰ã”ã¯ã‚“ã‚’å‘¼ã¶ï¼','ç ‚ç³–ã¨å¡©ã‚’é–“é•ãˆãŸï¼Ÿãã‚Œã¯æ–°ä½œã‚¹ã‚¤ãƒ¼ãƒ„â€¦ã‹ã‚‚ã—ã‚Œãªã„ã€‚',
      'åˆ‡ã‚Šã™ãã¦ã‚‚OKã€æ˜æ—¥ã®åˆ†ãŒã§ãã¾ã—ãŸã€‚','è¦‹ãŸç›®ãŒä¸æ€è­° â†’ â€œå‰è¡›æ–™ç†â€ ã¨åä»˜ã‘ã‚ˆã†ã€‚'
    ];

    // ç‰¹å®šã®çµ„ã¿åˆã‚ã›å‘ã‘ãƒ¬ã‚·ãƒ”ï¼ˆã‚­ãƒ¼ã¯ã‚½ãƒ¼ãƒˆã—ã¦ "é£ŸæA|é£ŸæB"ï¼‰
    const SPECIALS = {
      'ãƒˆãƒãƒˆ|åµ': {
        title: 'ãƒˆãƒãƒˆã¨åµã®ãµã‚ã¨ã‚ã‚ªãƒ ãƒ¬ãƒ„',
        method: 'ç„¼ã',
        steps: (effort)=> baseSteps(effort, [
          'ãƒˆãƒãƒˆã¯ä¸€å£å¤§ã«åˆ‡ã‚‹ã€‚åµã¯ãƒœã‚¦ãƒ«ã§æº¶ãã€‚',
          'ãƒ•ãƒ©ã‚¤ãƒ‘ãƒ³ã«æ²¹ã‚’æ¸©ã‚ã€ãƒˆãƒãƒˆã‚’ã‚µãƒƒã¨ç‚’ã‚ã‚‹ã€‚',
          'æº¶ãåµã‚’æµã—å…¥ã‚Œã€åŠç†Ÿã§æŠ˜ã‚ŠãŸãŸã‚€ã€‚',
        ])
      },
      'ã”ã¯ã‚“|åµ': {
        title: 'é»„é‡‘ã®ãŸã¾ã”ã‹ã‘ã”ã¯ã‚“ï¼ˆTKGï¼‰',
        method: 'å’Œãˆã‚‹',
        steps: (effort)=> baseSteps(effort, [
          'ã‚ã¤ã‚ã¤ã”ã¯ã‚“ã‚’å™¨ã«ã‚ˆãã†ã€‚',
          'åµã‚’å‰²ã‚Šå…¥ã‚Œã€ã—ã‚‡ã†ã‚†å°‘ã€…ã§æ··ãœã‚‹ã€‚',
          'ãŠå¥½ã¿ã§ã®ã‚Šã‚„ãƒã‚®ã‚’ã‚ªãƒ³ï¼',
        ])
      },
      'ãƒ‘ã‚¹ã‚¿|ãƒ„ãƒŠç¼¶': {
        title: 'ãƒ„ãƒŠãƒãƒ¨ãƒ‘ã‚¹ã‚¿',
        method: 'å’Œãˆã‚‹',
        steps: (effort)=> baseSteps(effort, [
          'ãƒ‘ã‚¹ã‚¿ã‚’è¢‹ã®è¡¨ç¤ºé€šã‚Šã«ã‚†ã§ã‚‹ã€‚',
          'ãƒ„ãƒŠãƒ»ãƒãƒ¨ãƒ»å¡©ã‚³ã‚·ãƒ§ã‚¦ã‚’ãƒœã‚¦ãƒ«ã§æ··ãœã‚‹ã€‚',
          'ã‚†ã§ä¸ŠãŒã£ãŸãƒ‘ã‚¹ã‚¿ã¨å’Œãˆã€ä»•ä¸Šã’ã«ã—ã‚‡ã†ã‚†å°‘ã€…ã€‚',
        ])
      },
      'é£Ÿãƒ‘ãƒ³|ãƒãƒ¼ã‚º': {
        title: 'ã¨ã‚ã‘ã‚‹ãƒãƒ¼ã‚ºãƒˆãƒ¼ã‚¹ãƒˆ',
        method: 'ç„¼ã',
        steps: (effort)=> baseSteps(effort, [
          'é£Ÿãƒ‘ãƒ³ã«ãƒãƒ¼ã‚ºã‚’ã®ã›ã‚‹ã€‚',
          'ãƒˆãƒ¼ã‚¹ã‚¿ãƒ¼ã§ã“ã‚“ãŒã‚Šç„¼ãã€‚',
          'ä»•ä¸Šã’ã«é»’ã“ã—ã‚‡ã†ã§å¤§äººå‘³ã€‚',
        ])
      },
      'ã˜ã‚ƒãŒã„ã‚‚|ãƒ™ãƒ¼ã‚³ãƒ³': {
        title: 'ãƒ™ãƒ¼ã‚³ãƒ³ãƒãƒ†ãƒˆã®é¦™ã°ã—ç‚’ã‚',
        method: 'ç‚’ã‚ã‚‹',
        steps: (effort)=> baseSteps(effort, [
          'ã˜ã‚ƒãŒã„ã‚‚ã¯ç´°åˆ‡ã‚Šã€ãƒ™ãƒ¼ã‚³ãƒ³ã¯é£Ÿã¹ã‚„ã™ãåˆ‡ã‚‹ã€‚',
          'ãƒ•ãƒ©ã‚¤ãƒ‘ãƒ³ã§ãƒ™ãƒ¼ã‚³ãƒ³â†’ã˜ã‚ƒãŒã„ã‚‚ã‚’ç‚’ã‚ã‚‹ã€‚',
          'å¡©ã‚³ã‚·ãƒ§ã‚¦ã§å‘³ã‚’ã¨ã¨ã®ãˆã‚‹ã€‚',
        ])
      },
      'è±†è…|ã­ã': {
        title: 'ç©¶æ¥µã®å†·ã‚„ã‚„ã£ã“ï¼ˆã­ããŸã£ã·ã‚Šï¼‰',
        method: 'ãã®ã¾ã¾',
        steps: (effort)=> baseSteps(effort, [
          'è±†è…ã‚’çš¿ã«å‡ºã™ã€‚',
          'ã­ããƒ»ã—ã‚‡ã†ã‚†ãƒ»ãŠå¥½ã¿ã§ã‹ã¤ãŠç¯€ã‚’ã‚ªãƒ³ã€‚',
          'ã”ã¾æ²¹ã‚’æ•°æ»´ãŸã‚‰ã™ã¨ãƒ—ãƒ­ã£ã½ã„ã€‚',
        ])
      }
    };

    const METHODS = ['ç‚’ã‚', 'å’Œãˆ', 'ãƒˆãƒ¼ã‚¹ãƒˆ', 'ã‚ªãƒ ãƒ¬ãƒ„', 'ã‚µãƒ©ãƒ€', 'ã‚¹ãƒ¼ãƒ—'];

    // ====== è¦ç´ å–å¾— ======
    const chipBox = document.getElementById('chipBox');
    const input = document.getElementById('ingredientInput');
    const quick = document.getElementById('quick');
    const genBtn = document.getElementById('gen');
    const againBtn = document.getElementById('again');
    const resetBtn = document.getElementById('reset');
    const randomFillBtn = document.getElementById('randomFill');
    const copyBtn = document.getElementById('copy');
    const effort = document.getElementById('effort');
    const effortFace = document.getElementById('effortFace');

    const recipeTitle = document.getElementById('recipeTitle');
    const stepsEl = document.getElementById('steps');
    const usedEl = document.getElementById('used');
    const commentEl = document.getElementById('comment');
    const failEl = document.getElementById('fail');
    const badge = document.getElementById('badge');

    const confettiCanvas = document.getElementById('confetti');
    const ctx = confettiCanvas.getContext('2d');

    let ingredients = new Set();
    let currentPicked = null; // ç›´è¿‘ã®ãƒ¬ã‚·ãƒ”å®šç¾©ã‚’ä¿æŒã—ã¦ã€ã‚„ã‚‹æ°—ãƒ¬ãƒ™ãƒ«å¤‰æ›´ã§æ‰‹é †ã ã‘æ›´æ–°

    // ====== åˆæœŸåŒ– ======
    function init(){
      // ã‚¯ã‚¤ãƒƒã‚¯ãƒœã‚¿ãƒ³
      COMMON_ING.forEach(name=>{
        const b = document.createElement('button');
        b.type = 'button'; b.textContent = name; b.addEventListener('click', ()=> addIngredient(name));
        quick.appendChild(b);
      });
      // å‰å›ã®ææ–™
      const saved = JSON.parse(localStorage.getItem('rrg.ingredients')||'[]');
      saved.forEach(addIngredient);

      renderChips();
      onResize();
      window.addEventListener('resize', onResize);
      // åˆæœŸè¡¨ç¤ºã®é¡”ãƒ»ãƒãƒƒã‚¸ã‚’åŒæœŸ
      effort.dispatchEvent(new Event('input'));
    }

    function onResize(){
      confettiCanvas.width = window.innerWidth; confettiCanvas.height = window.innerHeight;
    }

    // ====== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ======
    function sanitize(s){ return s.replace(/[\sã€€]+/g,'').replace(/[\,ï¼Œã€]/g,''); }

    function addIngredient(name){
      name = sanitize(name);
      if(!name) return;
      ingredients.add(name);
      renderChips();
      persist();
    }
    function removeIngredient(name){
      ingredients.delete(name);
      renderChips();
      persist();
    }
    function renderChips(){
      // æ—¢å­˜ã®ãƒãƒƒãƒ—å‰Šé™¤ï¼ˆå…¥åŠ›ã¯æ®‹ã™ï¼‰
      const chips = chipBox.querySelectorAll('.chip'); chips.forEach(c=>c.remove());
      ingredients.forEach(name=>{
        const chip = document.createElement('span'); chip.className='chip'; chip.setAttribute('role','listitem');
        chip.innerHTML = `<span>${name}</span>`;
        const x = document.createElement('button'); x.className='x'; x.type='button'; x.setAttribute('aria-label', `${name} ã‚’å‰Šé™¤`); x.textContent='Ã—';
        x.addEventListener('click', ()=> removeIngredient(name));
        chip.appendChild(x);
        chipBox.insertBefore(chip, input);
      });
    }
    function persist(){ localStorage.setItem('rrg.ingredients', JSON.stringify([...ingredients])); }

    input.addEventListener('keydown', (e)=>{
      if(e.key==='Enter' || e.key===','){
        e.preventDefault();
        const parts = input.value.split(/[ã€,]/).map(v=>v.trim()).filter(Boolean);
        parts.forEach(addIngredient);
        input.value='';
      }
    });

    resetBtn.addEventListener('click', ()=>{ ingredients.clear(); renderChips(); persist(); clearResult(); });
    randomFillBtn.addEventListener('click', ()=>{
      // ãƒ©ãƒ³ãƒ€ãƒ ã«3ã€œ5å€‹
      const n = 3 + Math.floor(Math.random()*3);
      const shuffled = [...COMMON_ING].sort(()=>Math.random()-0.5).slice(0,n);
      shuffled.forEach(addIngredient);
    });

    effort.addEventListener('input', ()=>{
      const faces = {1:'ğŸ˜ª', 2:'ğŸ™‚', 3:'ğŸ’ª'}; effortFace.textContent = faces[effort.value] || 'ğŸ™‚';
      const tags = {1:'è¶…ã‹ã‚“ãŸã‚“', 2:'ã‹ã‚“ãŸã‚“', 3:'ã—ã£ã‹ã‚Š'}; badge.textContent = tags[effort.value] || 'ã‹ã‚“ãŸã‚“';
      // æ—¢ã«ãƒ¬ã‚·ãƒ”ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€æ‰‹é †ã ã‘ã‚’ç¾åœ¨ã®ã‚„ã‚‹æ°—ãƒ¬ãƒ™ãƒ«ã«åˆã‚ã›ã¦æ›´æ–°
      if(currentPicked && stepsEl.children.length){
        const s = currentPicked.steps(Number(effort.value));
        stepsEl.innerHTML = '';
        s.forEach(t=>{ const li=document.createElement('li'); li.textContent=t; stepsEl.appendChild(li); });
      }
    });

    genBtn.addEventListener('click', generateRecipe);
    againBtn.addEventListener('click', generateRecipe);

    copyBtn.addEventListener('click', async ()=>{
      const text = `ã€ãƒ¬ã‚·ãƒ”ã€‘${recipeTitle.textContent}\nææ–™ï¼š${usedEl.textContent.replace('ä½¿ã†ã‚‚ã®ï¼š','').trim()}\næ‰‹é †ï¼š\n${[...stepsEl.querySelectorAll('li')].map((li,i)=>`${i+1}. ${li.textContent}`).join('\n')}\nã‚³ãƒ¡ãƒ³ãƒˆï¼š${commentEl.textContent}\nå¤±æ•—ã—ãŸã‚‰ï¼š${failEl.textContent}`;
      try{ await navigator.clipboard.writeText(text); copyBtn.textContent='ã‚³ãƒ”ãƒ¼å®Œäº†ï¼'; setTimeout(()=> copyBtn.textContent='ã‚³ãƒ”ãƒ¼', 1500); }catch{
        alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
    });

    function clearResult(){
      recipeTitle.textContent = 'ã¾ã ä½•ã‚‚æ±ºã¾ã£ã¦ã„ã¾ã›ã‚“';
      usedEl.textContent = 'ææ–™ã‚’å…¥ã‚Œã¦ã€Œãƒ¬ã‚·ãƒ”ç”Ÿæˆã€ã‚’æŠ¼ã—ã¦ã­ã€‚';
      stepsEl.innerHTML = ''; commentEl.textContent = ''; failEl.textContent='';
    }

    // ====== ãƒ¬ã‚·ãƒ”ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ ======
    function generateRecipe(){
      if(ingredients.size===0){
        recipeTitle.textContent = 'ææ–™ãŒã‚ã‚Šã¾ã›ã‚“ğŸ¥º';
        usedEl.textContent = 'ä¾‹ï¼šåµ / ãƒˆãƒãƒˆ / ã”ã¯ã‚“ ãªã©ã‚’è¿½åŠ ã—ã¦ã­ã€‚';
        stepsEl.innerHTML = ''; commentEl.textContent=''; failEl.textContent='';
        wiggle(genBtn);
        return;
      }

      const ingList = [...ingredients];
      const known = ingList.filter(x=> COMMON_ING.includes(x));

      // ç‰¹æ®Šãƒ¬ã‚·ãƒ”å€™è£œ
      const pairs = [];
      for(let i=0;i<known.length;i++){
        for(let j=i+1;j<known.length;j++){
          const k = [known[i], known[j]].sort().join('|');
          if(SPECIALS[k]) pairs.push(SPECIALS[k]);
        }
      }

      let picked;
      if(pairs.length){
        picked = pairs[Math.floor(Math.random()*pairs.length)];
      }else{
        // æ±ç”¨ãƒ¬ã‚·ãƒ”
        const chosen = sample(known.length?known:ingList, 2);
        const method = smartMethod(chosen);
        const title = makeTitle(chosen, method);
        picked = { title, method, steps: (eff)=> genericSteps(chosen, method, eff) };
      }

      // å‡ºåŠ›
      currentPicked = picked; // ä»¥é™ã®ã‚„ã‚‹æ°—ãƒ¬ãƒ™ãƒ«å¤‰æ›´ã§æ‰‹é †ã‚’å†æ§‹æˆã§ãã‚‹ã‚ˆã†ã«ä¿æŒ
      const usedNames = known.length? known : ingList;
      recipeTitle.textContent = picked.title + getRand(['', ' âœ¨', ' â­']);
      usedEl.textContent = 'ä½¿ã†ã‚‚ã®ï¼š' + usedNames.slice(0,5).join(' / ') + (usedNames.length>5 ? ` ä»–${usedNames.length-5}ä»¶` : '');

      const s = picked.steps(Number(effort.value));
      stepsEl.innerHTML = '';
      s.forEach(t=>{ const li=document.createElement('li'); li.textContent=t; stepsEl.appendChild(li); });

      commentEl.textContent = getRand(HUMOR);
      failEl.textContent = getRand(FAIL_JOKES);

      // ãŠç¥ã„ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
      confetti();
    }

    function baseSteps(effort, base){
      const extra = [
        'å‘³è¦‹ã—ã¦OKãªã‚‰å®Œæˆï¼',
        'çš¿ã«ç››ã£ã¦å†™çœŸã‚’ãƒ‘ã‚·ãƒ£ãƒªğŸ“·',
        'å¥½ã¿ã§ãƒãƒ¼ã‚ºã‚„ã®ã‚Šã‚’è¿½åŠ ã—ã¦ãƒ‰ãƒ¤é¡”ã€‚'
      ];
      if(effort<=1) return [base[1]||base[0], extra[0]]; // ã–ã£ãã‚Š
      if(effort===2) return base.concat([extra[0]]);
      return base.concat(['é¦™ã‚Šã¥ã‘ã«ãƒã‚¿ãƒ¼ã‚„ã”ã¾æ²¹ã‚’ã²ã¨å›ã—ã€‚', extra[1]]);
    }

    function genericSteps(chosen, method, effort){
      const a = chosen[0], b = chosen[1];
      const base = {
        'ç‚’ã‚': [
          `${a}ã¨${b}ã‚’é£Ÿã¹ã‚„ã™ãåˆ‡ã‚‹ã€‚`,
          'ãƒ•ãƒ©ã‚¤ãƒ‘ãƒ³ã«æ²¹ã‚’ç†±ã—ã€ææ–™ã‚’ç‚’ã‚ã‚‹ã€‚',
          'å¡©ã‚³ã‚·ãƒ§ã‚¦ï¼ˆå¥½ã¿ã§é†¤æ²¹ï¼‰ã§å‘³ã‚’ã¨ã¨ã®ãˆã‚‹ã€‚',
        ],
        'å’Œãˆ': [
          `${a}ã¨${b}ã‚’ãƒœã‚¦ãƒ«ã«å…¥ã‚Œã‚‹ã€‚`,
          'ãƒãƒ¨ã‚„å¡©ã§ã•ã£ã¨å’Œãˆã‚‹ã€‚',
          'é»’ã“ã—ã‚‡ã†ã‚’å°‘ã€…ã€‚',
        ],
        'ãƒˆãƒ¼ã‚¹ãƒˆ': [
          `é£Ÿãƒ‘ãƒ³ã«${a}ã¨${b}ã‚’ã®ã›ã‚‹ã€‚`,
          'ãƒˆãƒ¼ã‚¹ã‚¿ãƒ¼ã§ã“ã‚“ãŒã‚Šç„¼ãã€‚',
          'ä»•ä¸Šã’ã«ã‚±ãƒãƒ£ãƒƒãƒ—ã‚„èœ‚èœœã§ã‚¢ãƒ¬ãƒ³ã‚¸ã€‚',
        ],
        'ã‚ªãƒ ãƒ¬ãƒ„': [
          `${a}ã¨${b}ã‚’åˆ»ã¿ã€åµã§åŒ…ã‚€ã€‚`,
          'ãƒ•ãƒ©ã‚¤ãƒ‘ãƒ³ã§ãµã‚“ã‚ã‚Šç„¼ãã€‚',
          'ã‚±ãƒãƒ£ãƒƒãƒ—ã§ãŠçµµæãã€‚',
        ],
        'ã‚µãƒ©ãƒ€': [
          `${a}ã¨${b}ã‚’ã²ã¨å£å¤§ã«ã€‚`,
          'å¡©ãƒ»ã‚ªãƒªãƒ¼ãƒ–ã‚ªã‚¤ãƒ«ãƒ»ãƒ¬ãƒ¢ãƒ³ã§ã•ã£ã±ã‚Šã€‚',
          'æœ€å¾Œã«ãƒãƒ¼ã‚ºã‚’æ•£ã‚‰ã™ã¨ãƒªãƒƒãƒã€‚',
        ],
        'ã‚¹ãƒ¼ãƒ—': [
          `${a}ã¨${b}ã‚’å°ã•ã‚ã«åˆ‡ã‚‹ã€‚`,
          'æ°´ã¨ã‚³ãƒ³ã‚½ãƒ¡ã§ã‚³ãƒˆã‚³ãƒˆç…®ã‚‹ã€‚',
          'å‘³ã‚’è¦‹ã¦å¡©ã‚’å°‘ã—ã€‚',
        ],
      }[method] || [`${a}ã¨${b}ã‚’åˆã‚ã›ã¦è‰¯ã„æ„Ÿã˜ã«ã™ã‚‹ã€‚`, 'å‘³ã‚’è¦‹ã¦å®Œæˆï¼'];
      return baseSteps(effort, base);
    }

    function smartMethod(ch){
      const set = new Set(ch);
      if(set.has('ã”ã¯ã‚“')) return 'ç‚’ã‚'; // ãƒãƒ£ãƒ¼ãƒãƒ³ç³»
      if(set.has('é£Ÿãƒ‘ãƒ³')) return 'ãƒˆãƒ¼ã‚¹ãƒˆ';
      if(set.has('ãƒ‘ã‚¹ã‚¿')) return 'å’Œãˆ';
      if(set.has('åµ')) return 'ã‚ªãƒ ãƒ¬ãƒ„';
      return METHODS[Math.floor(Math.random()*METHODS.length)];
    }

    function makeTitle(ch, method){
      const a = ch[0], b = ch[1];
      const map = {
        'ç‚’ã‚': `${a}ã¨${b}ã®ãƒ•ãƒ©ã‚¤ãƒ‘ãƒ³ç‚’ã‚`,
        'å’Œãˆ': `${a}ã¨${b}ã®ç§’é€Ÿã‚ãˆ`,
        'ãƒˆãƒ¼ã‚¹ãƒˆ': `${a}${b}ã”ã¡ãã†ãƒˆãƒ¼ã‚¹ãƒˆ`,
        'ã‚ªãƒ ãƒ¬ãƒ„': `${a}ã¨${b}ã®ãµã‚ãµã‚ã‚ªãƒ ãƒ¬ãƒ„`,
        'ã‚µãƒ©ãƒ€': `${a}Ã—${b} ãƒ‘ãƒ‘ãƒƒã¨ã‚µãƒ©ãƒ€`,
        'ã‚¹ãƒ¼ãƒ—': `${a}ã¨${b}ã®ã»ã£ã“ã‚Šã‚¹ãƒ¼ãƒ—`,
      };
      return map[method] || `${a}ã¨${b}ã®é©å½“ã‚­ãƒƒãƒãƒ³`;
    }

    function sample(arr, n){
      const a=[...arr];
      for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; }
      return a.slice(0, Math.max(1, Math.min(n, a.length)));
    }
    function getRand(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

    function wiggle(el){ el.animate([{transform:'translateX(0)'},{transform:'translateX(-4px)'},{transform:'translateX(4px)'},{transform:'translateX(0)'}], {duration:300}); }

    // ====== ã‚³ãƒ³ãƒ•ã‚§ãƒƒãƒ†ã‚£ ======
    function confetti(){
      const pieces = Array.from({length: 120}, ()=>({
        x: Math.random()*confettiCanvas.width,
        y: -10 - Math.random()*40,
        size: 4 + Math.random()*6,
        vy: 2 + Math.random()*3,
        vx: -1 + Math.random()*2,
        rot: Math.random()*Math.PI,
        vr: -0.2 + Math.random()*0.4,
      }));
      let t=0; const dur=90;
      function tick(){
        t++; ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
        pieces.forEach(p=>{
          p.x += p.vx; p.y += p.vy; p.rot += p.vr;
          ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.rot);
          ctx.fillStyle = `hsl(${(p.x+p.y)%360} 80% 60%)`; // è™¹è‰²
          ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size);
          ctx.restore();
        });
        if(t<dur) requestAnimationFrame(tick); else ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
      }
      tick();
    }

    init();
  </script>
</body>
</html>
