<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ランダムレシピジェネレーター</title>
  <meta name="description" content="手持ちの材料からランダムで簡単レシピを提案。ユーモア付きで料理タイムを楽しく！"/>
  <style>
    :root{
      --bg: 255 255 255;
      --fg: 22 24 29;
      --muted: 110 114 120;
      --accent: 99 102 241; /* indigo */
      --accent-2: 16 185 129; /* emerald */
      --card: 255 255 255;
      --glass: 255 255 255 / .55;
      color-scheme: light dark;
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg: 12 14 18;
        --fg: 233 234 239;
        --muted: 160 166 176;
        --card: 22 24 29;
        --glass: 22 24 29 / .55;
      }
    }
    *{ box-sizing: border-box; }
    html,body{ height:100%; }
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans JP, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, Arial, sans-serif;
      color: rgb(var(--fg));
      background:
        radial-gradient(1200px 600px at 10% 10%, rgba(var(--accent),.08), transparent 60%),
        radial-gradient(1200px 600px at 90% 0%, rgba(var(--accent-2),.08), transparent 60%),
        linear-gradient(180deg, rgba(var(--bg),1), rgba(var(--bg),1));
    }
    header{
      position:sticky; top:0; z-index:5;
      backdrop-filter: blur(8px);
      background: linear-gradient(180deg, rgba(var(--glass)), rgba(var(--glass), .65));
      border-bottom: 1px solid rgba(var(--fg), .06);
    }
    .wrap{ max-width: 980px; margin: 0 auto; padding: 18px 20px; }
    .title{ display:flex; gap:12px; align-items:center; }
    .logo{ width:38px; height:38px; border-radius:14px; display:grid; place-items:center; font-size:20px;
      background: linear-gradient(135deg, rgba(var(--accent),.9), rgba(var(--accent-2),.9)); color:white; box-shadow: 0 8px 24px rgba(var(--accent), .25);
    }
    h1{ font-size: clamp(22px, 3.2vw, 34px); margin:0; letter-spacing:.02em; }
    .sub{ color: rgb(var(--muted)); font-size: 14px; }

    main{ padding: 24px 20px 72px; }

    .card{
      background: linear-gradient(180deg, rgba(var(--card), .65), rgba(var(--card), .8));
      backdrop-filter: blur(10px);
      border:1px solid rgba(var(--fg), .08);
      border-radius: 20px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,.08);
    }
    .grid{ display:grid; grid-template-columns: 1.1fr .9fr; gap:20px; }
    @media (max-width: 920px){ .grid{ grid-template-columns: 1fr; } }

    .section-title{ font-weight:700; margin: 0 0 10px; font-size: 15px; letter-spacing:.04em; text-transform: uppercase; color: rgb(var(--muted)); }

    /* Input chips */
    .chip-box{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; padding: 10px; border:1px dashed rgba(var(--fg), .15); border-radius: 16px; background: rgba(var(--card), .5); }
    .chip{ display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius: 999px; background: rgba(var(--accent), .08); border:1px solid rgba(var(--accent), .18); }
    .chip .x{ width:18px; height:18px; border:none; border-radius:999px; display:grid; place-items:center; background: rgba(var(--accent), .2); color:white; cursor:pointer; }
    .chip .x:hover{ filter: brightness(1.05); }

    .input{ flex:1; min-width: 180px; border:none; outline:none; padding:10px 12px; background: transparent; color: rgb(var(--fg)); font-size:16px; }
    .helper{ font-size:12px; color: rgb(var(--muted)); margin-top: 6px; }

    .quick{ display:flex; flex-wrap:wrap; gap:8px; }
    .quick button{ padding:7px 12px; border-radius:999px; border:1px solid rgba(var(--fg), .12); background: rgba(var(--fg), .04); cursor:pointer; }
    .quick button:hover{ transform: translateY(-1px); }

    .controls{ display:flex; flex-wrap:wrap; gap:12px; align-items:center; justify-content: space-between; margin-top:14px; }
    .left, .right{ display:flex; flex-wrap:wrap; gap:12px; align-items:center; }
    .btn{ border:none; cursor:pointer; padding:12px 16px; border-radius: 14px; font-weight:700; letter-spacing:.02em; background: linear-gradient(135deg, rgba(var(--accent),.95), rgba(var(--accent-2),.95)); color:white; box-shadow: 0 10px 22px rgba(var(--accent), .25); }
    .btn.secondary{ background: rgba(var(--fg), .06); color: rgb(var(--fg)); box-shadow:none; border:1px solid rgba(var(--fg), .12); }
    .btn.ghost{ background: transparent; color: rgb(var(--fg)); border:1px dashed rgba(var(--fg), .18); box-shadow:none; }
    .btn:active{ transform: translateY(1px); }

    .slider{ appearance:none; height:6px; border-radius:999px; background: rgba(var(--fg), .12); outline:none; width:180px; }
    .slider::-webkit-slider-thumb{ -webkit-appearance:none; appearance:none; width:20px; height:20px; border-radius:50%; background: linear-gradient(135deg, rgba(var(--accent),1), rgba(var(--accent-2),1)); box-shadow: 0 4px 10px rgba(0,0,0,.2);
      border: 2px solid white; }

    /* Result */
    .result{ display:none; margin-top: 18px; }
    .recipe-card{ position:relative; overflow:hidden; }
    .badge{ position:absolute; top:16px; right:16px; padding:6px 10px; border-radius:999px; font-size:12px; background: rgba(var(--accent), .15); border:1px solid rgba(var(--accent), .3); }
    .recipe-title{ font-size: clamp(18px, 2.8vw, 26px); margin: 6px 0 10px; }
    .used{ color: rgb(var(--muted)); font-size: 14px; }
    .steps{ margin: 12px 0 0; padding:0 0 0 22px; }
    .steps li{ margin: 6px 0; }
    .comment{ margin-top: 10px; font-weight:700; }
    .fail{ margin-top: 8px; color: rgb(var(--muted)); font-size: 14px; }

    .footer{ margin-top: 26px; font-size: 12px; color: rgb(var(--muted)); text-align:center; }

    /* Confetti canvas */
    #confetti{ position: fixed; inset:0; pointer-events: none; z-index: 10; }
  </style>
</head>
<body>
  <canvas id="confetti"></canvas>
  <header>
    <div class="wrap title">
      <div class="logo" aria-hidden="true">🍳</div>
      <div>
        <h1>ランダムレシピジェネレーター</h1>
        <div class="sub">材料を入れるだけ。<strong>運とノリ</strong>で今日の一皿、できちゃいます。</div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div class="grid">
      <section class="card">
        <p class="section-title">材料を入力</p>
        <div class="chip-box" id="chipBox" aria-live="polite">
          <input id="ingredientInput" class="input" type="text" placeholder="例: 卵, トマト, チーズ など。Enterで追加" aria-label="材料を入力"/>
        </div>
        <div class="helper">ヒント: カンマ（,）やEnterで追加。いらないチップは×で消せます。</div>

        <div style="height:10px"></div>
        <p class="section-title">よく使う材料（クリックで追加）</p>
        <div class="quick" id="quick"></div>

        <div class="controls">
          <div class="left">
            <button class="btn" id="gen">レシピ生成 🎲</button>
            <button class="btn secondary" id="reset">リセット</button>
            <button class="btn ghost" id="randomFill">おまかせで材料追加</button>
          </div>
          <div class="right" title="手順をどこまで詳しくするか">
            <span style="font-size:12px;color:rgb(var(--muted));">やる気レベル</span>
            <input type="range" min="1" max="3" value="2" step="1" id="effort" class="slider"/>
            <span id="effortFace" aria-hidden="true">💪</span>
          </div>
        </div>
      </section>

      <section class="card recipe-card">
        <span class="badge" id="badge">かんたん</span>
        <h2 class="recipe-title" id="recipeTitle">まだ何も決まっていません</h2>
        <div class="used" id="used">材料を入れて「レシピ生成」を押してね。</div>
        <ol class="steps" id="steps"></ol>
        <div class="comment" id="comment"></div>
        <div class="fail" id="fail"></div>
        <div class="controls" style="margin-top:14px;">
          <div class="left">
            <button class="btn secondary" id="again">もう一回！</button>
            <button class="btn ghost" id="copy">コピー</button>
          </div>
          <div class="right">
            <small class="sub">※安全第一：食材は火を通しすぎず、でもしっかり。</small>
          </div>
        </div>
      </section>
    </div>

    <p class="footer">© ランダムレシピジェネレーター – 失敗してもOK。最悪、<em>ピザ屋にGO</em>。</p>
  </main>

  <script>
    // ====== データ ======
    const COMMON_ING = [
      '卵','トマト','玉ねぎ','ほうれん草','きのこ','じゃがいも','にんじん','キャベツ','ピーマン','ねぎ',
      'ごはん','パスタ','食パン',
      'ツナ缶','豆腐','鶏むね','ベーコン','ハム','ウインナー',
      'チーズ','のり','マヨネーズ','ケチャップ','バター','オリーブオイル'
    ];

    const HUMOR = [
      'これでシェフ気分！','まるでTVのワンコーナー。','味見は2回まで（1回目は確認、2回目はご褒美）。',
      '洗い物を減らせた人が真の勝者。','盛りつけで8割勝てる説。','BGMは自由。踊ってもOK。'
    ];

    const FAIL_JOKES = [
      '焦げたらピザ屋にGO。','味が薄かったら「上品」と言い張ろう。',
      'しょっぱかったらごはんを呼ぶ！','砂糖と塩を間違えた？それは新作スイーツ…かもしれない。',
      '切りすぎてもOK、明日の分ができました。','見た目が不思議 → “前衛料理” と名付けよう。'
    ];

    // 特定の組み合わせ向けレシピ（キーはソートして "食材A|食材B"）
    const SPECIALS = {
      'トマト|卵': {
        title: 'トマトと卵のふわとろオムレツ',
        method: '焼く',
        steps: (effort)=> baseSteps(effort, [
          'トマトは一口大に切る。卵はボウルで溶く。',
          'フライパンに油を温め、トマトをサッと炒める。',
          '溶き卵を流し入れ、半熟で折りたたむ。',
        ])
      },
      'ごはん|卵': {
        title: '黄金のたまごかけごはん（TKG）',
        method: '和える',
        steps: (effort)=> baseSteps(effort, [
          'あつあつごはんを器によそう。',
          '卵を割り入れ、しょうゆ少々で混ぜる。',
          'お好みでのりやネギをオン！',
        ])
      },
      'パスタ|ツナ缶': {
        title: 'ツナマヨパスタ',
        method: '和える',
        steps: (effort)=> baseSteps(effort, [
          'パスタを袋の表示通りにゆでる。',
          'ツナ・マヨ・塩コショウをボウルで混ぜる。',
          'ゆで上がったパスタと和え、仕上げにしょうゆ少々。',
        ])
      },
      '食パン|チーズ': {
        title: 'とろけるチーズトースト',
        method: '焼く',
        steps: (effort)=> baseSteps(effort, [
          '食パンにチーズをのせる。',
          'トースターでこんがり焼く。',
          '仕上げに黒こしょうで大人味。',
        ])
      },
      'じゃがいも|ベーコン': {
        title: 'ベーコンポテトの香ばし炒め',
        method: '炒める',
        steps: (effort)=> baseSteps(effort, [
          'じゃがいもは細切り、ベーコンは食べやすく切る。',
          'フライパンでベーコン→じゃがいもを炒める。',
          '塩コショウで味をととのえる。',
        ])
      },
      '豆腐|ねぎ': {
        title: '究極の冷ややっこ（ねぎたっぷり）',
        method: 'そのまま',
        steps: (effort)=> baseSteps(effort, [
          '豆腐を皿に出す。',
          'ねぎ・しょうゆ・お好みでかつお節をオン。',
          'ごま油を数滴たらすとプロっぽい。',
        ])
      }
    };

    const METHODS = ['炒め', '和え', 'トースト', 'オムレツ', 'サラダ', 'スープ'];

    // ====== 要素取得 ======
    const chipBox = document.getElementById('chipBox');
    const input = document.getElementById('ingredientInput');
    const quick = document.getElementById('quick');
    const genBtn = document.getElementById('gen');
    const againBtn = document.getElementById('again');
    const resetBtn = document.getElementById('reset');
    const randomFillBtn = document.getElementById('randomFill');
    const copyBtn = document.getElementById('copy');
    const effort = document.getElementById('effort');
    const effortFace = document.getElementById('effortFace');

    const recipeTitle = document.getElementById('recipeTitle');
    const stepsEl = document.getElementById('steps');
    const usedEl = document.getElementById('used');
    const commentEl = document.getElementById('comment');
    const failEl = document.getElementById('fail');
    const badge = document.getElementById('badge');

    const confettiCanvas = document.getElementById('confetti');
    const ctx = confettiCanvas.getContext('2d');

    let ingredients = new Set();
    let currentPicked = null; // 直近のレシピ定義を保持して、やる気レベル変更で手順だけ更新

    // ====== 初期化 ======
    function init(){
      // クイックボタン
      COMMON_ING.forEach(name=>{
        const b = document.createElement('button');
        b.type = 'button'; b.textContent = name; b.addEventListener('click', ()=> addIngredient(name));
        quick.appendChild(b);
      });
      // 前回の材料
      const saved = JSON.parse(localStorage.getItem('rrg.ingredients')||'[]');
      saved.forEach(addIngredient);

      renderChips();
      onResize();
      window.addEventListener('resize', onResize);
      // 初期表示の顔・バッジを同期
      effort.dispatchEvent(new Event('input'));
    }

    function onResize(){
      confettiCanvas.width = window.innerWidth; confettiCanvas.height = window.innerHeight;
    }

    // ====== ユーティリティ ======
    function sanitize(s){ return s.replace(/[\s　]+/g,'').replace(/[\,，、]/g,''); }

    function addIngredient(name){
      name = sanitize(name);
      if(!name) return;
      ingredients.add(name);
      renderChips();
      persist();
    }
    function removeIngredient(name){
      ingredients.delete(name);
      renderChips();
      persist();
    }
    function renderChips(){
      // 既存のチップ削除（入力は残す）
      const chips = chipBox.querySelectorAll('.chip'); chips.forEach(c=>c.remove());
      ingredients.forEach(name=>{
        const chip = document.createElement('span'); chip.className='chip'; chip.setAttribute('role','listitem');
        chip.innerHTML = `<span>${name}</span>`;
        const x = document.createElement('button'); x.className='x'; x.type='button'; x.setAttribute('aria-label', `${name} を削除`); x.textContent='×';
        x.addEventListener('click', ()=> removeIngredient(name));
        chip.appendChild(x);
        chipBox.insertBefore(chip, input);
      });
    }
    function persist(){ localStorage.setItem('rrg.ingredients', JSON.stringify([...ingredients])); }

    input.addEventListener('keydown', (e)=>{
      if(e.key==='Enter' || e.key===','){
        e.preventDefault();
        const parts = input.value.split(/[、,]/).map(v=>v.trim()).filter(Boolean);
        parts.forEach(addIngredient);
        input.value='';
      }
    });

    resetBtn.addEventListener('click', ()=>{ ingredients.clear(); renderChips(); persist(); clearResult(); });
    randomFillBtn.addEventListener('click', ()=>{
      // ランダムに3〜5個
      const n = 3 + Math.floor(Math.random()*3);
      const shuffled = [...COMMON_ING].sort(()=>Math.random()-0.5).slice(0,n);
      shuffled.forEach(addIngredient);
    });

    effort.addEventListener('input', ()=>{
      const faces = {1:'😪', 2:'🙂', 3:'💪'}; effortFace.textContent = faces[effort.value] || '🙂';
      const tags = {1:'超かんたん', 2:'かんたん', 3:'しっかり'}; badge.textContent = tags[effort.value] || 'かんたん';
      // 既にレシピが表示されている場合は、手順だけを現在のやる気レベルに合わせて更新
      if(currentPicked && stepsEl.children.length){
        const s = currentPicked.steps(Number(effort.value));
        stepsEl.innerHTML = '';
        s.forEach(t=>{ const li=document.createElement('li'); li.textContent=t; stepsEl.appendChild(li); });
      }
    });

    genBtn.addEventListener('click', generateRecipe);
    againBtn.addEventListener('click', generateRecipe);

    copyBtn.addEventListener('click', async ()=>{
      const text = `【レシピ】${recipeTitle.textContent}\n材料：${usedEl.textContent.replace('使うもの：','').trim()}\n手順：\n${[...stepsEl.querySelectorAll('li')].map((li,i)=>`${i+1}. ${li.textContent}`).join('\n')}\nコメント：${commentEl.textContent}\n失敗したら：${failEl.textContent}`;
      try{ await navigator.clipboard.writeText(text); copyBtn.textContent='コピー完了！'; setTimeout(()=> copyBtn.textContent='コピー', 1500); }catch{
        alert('コピーに失敗しました');
      }
    });

    function clearResult(){
      recipeTitle.textContent = 'まだ何も決まっていません';
      usedEl.textContent = '材料を入れて「レシピ生成」を押してね。';
      stepsEl.innerHTML = ''; commentEl.textContent = ''; failEl.textContent='';
    }

    // ====== レシピ生成ロジック ======
    function generateRecipe(){
      if(ingredients.size===0){
        recipeTitle.textContent = '材料がありません🥺';
        usedEl.textContent = '例：卵 / トマト / ごはん などを追加してね。';
        stepsEl.innerHTML = ''; commentEl.textContent=''; failEl.textContent='';
        wiggle(genBtn);
        return;
      }

      const ingList = [...ingredients];
      const known = ingList.filter(x=> COMMON_ING.includes(x));

      // 特殊レシピ候補
      const pairs = [];
      for(let i=0;i<known.length;i++){
        for(let j=i+1;j<known.length;j++){
          const k = [known[i], known[j]].sort().join('|');
          if(SPECIALS[k]) pairs.push(SPECIALS[k]);
        }
      }

      let picked;
      if(pairs.length){
        picked = pairs[Math.floor(Math.random()*pairs.length)];
      }else{
        // 汎用レシピ
        const chosen = sample(known.length?known:ingList, 2);
        const method = smartMethod(chosen);
        const title = makeTitle(chosen, method);
        picked = { title, method, steps: (eff)=> genericSteps(chosen, method, eff) };
      }

      // 出力
      currentPicked = picked; // 以降のやる気レベル変更で手順を再構成できるように保持
      const usedNames = known.length? known : ingList;
      recipeTitle.textContent = picked.title + getRand(['', ' ✨', ' ⭐']);
      usedEl.textContent = '使うもの：' + usedNames.slice(0,5).join(' / ') + (usedNames.length>5 ? ` 他${usedNames.length-5}件` : '');

      const s = picked.steps(Number(effort.value));
      stepsEl.innerHTML = '';
      s.forEach(t=>{ const li=document.createElement('li'); li.textContent=t; stepsEl.appendChild(li); });

      commentEl.textContent = getRand(HUMOR);
      failEl.textContent = getRand(FAIL_JOKES);

      // お祝いエフェクト
      confetti();
    }

    function baseSteps(effort, base){
      const extra = [
        '味見してOKなら完成！',
        '皿に盛って写真をパシャリ📷',
        '好みでチーズやのりを追加してドヤ顔。'
      ];
      if(effort<=1) return [base[1]||base[0], extra[0]]; // ざっくり
      if(effort===2) return base.concat([extra[0]]);
      return base.concat(['香りづけにバターやごま油をひと回し。', extra[1]]);
    }

    function genericSteps(chosen, method, effort){
      const a = chosen[0], b = chosen[1];
      const base = {
        '炒め': [
          `${a}と${b}を食べやすく切る。`,
          'フライパンに油を熱し、材料を炒める。',
          '塩コショウ（好みで醤油）で味をととのえる。',
        ],
        '和え': [
          `${a}と${b}をボウルに入れる。`,
          'マヨや塩でさっと和える。',
          '黒こしょうを少々。',
        ],
        'トースト': [
          `食パンに${a}と${b}をのせる。`,
          'トースターでこんがり焼く。',
          '仕上げにケチャップや蜂蜜でアレンジ。',
        ],
        'オムレツ': [
          `${a}と${b}を刻み、卵で包む。`,
          'フライパンでふんわり焼く。',
          'ケチャップでお絵描き。',
        ],
        'サラダ': [
          `${a}と${b}をひと口大に。`,
          '塩・オリーブオイル・レモンでさっぱり。',
          '最後にチーズを散らすとリッチ。',
        ],
        'スープ': [
          `${a}と${b}を小さめに切る。`,
          '水とコンソメでコトコト煮る。',
          '味を見て塩を少し。',
        ],
      }[method] || [`${a}と${b}を合わせて良い感じにする。`, '味を見て完成！'];
      return baseSteps(effort, base);
    }

    function smartMethod(ch){
      const set = new Set(ch);
      if(set.has('ごはん')) return '炒め'; // チャーハン系
      if(set.has('食パン')) return 'トースト';
      if(set.has('パスタ')) return '和え';
      if(set.has('卵')) return 'オムレツ';
      return METHODS[Math.floor(Math.random()*METHODS.length)];
    }

    function makeTitle(ch, method){
      const a = ch[0], b = ch[1];
      const map = {
        '炒め': `${a}と${b}のフライパン炒め`,
        '和え': `${a}と${b}の秒速あえ`,
        'トースト': `${a}${b}ごちそうトースト`,
        'オムレツ': `${a}と${b}のふわふわオムレツ`,
        'サラダ': `${a}×${b} パパッとサラダ`,
        'スープ': `${a}と${b}のほっこりスープ`,
      };
      return map[method] || `${a}と${b}の適当キッチン`;
    }

    function sample(arr, n){
      const a=[...arr];
      for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; }
      return a.slice(0, Math.max(1, Math.min(n, a.length)));
    }
    function getRand(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

    function wiggle(el){ el.animate([{transform:'translateX(0)'},{transform:'translateX(-4px)'},{transform:'translateX(4px)'},{transform:'translateX(0)'}], {duration:300}); }

    // ====== コンフェッティ ======
    function confetti(){
      const pieces = Array.from({length: 120}, ()=>({
        x: Math.random()*confettiCanvas.width,
        y: -10 - Math.random()*40,
        size: 4 + Math.random()*6,
        vy: 2 + Math.random()*3,
        vx: -1 + Math.random()*2,
        rot: Math.random()*Math.PI,
        vr: -0.2 + Math.random()*0.4,
      }));
      let t=0; const dur=90;
      function tick(){
        t++; ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
        pieces.forEach(p=>{
          p.x += p.vx; p.y += p.vy; p.rot += p.vr;
          ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.rot);
          ctx.fillStyle = `hsl(${(p.x+p.y)%360} 80% 60%)`; // 虹色
          ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size);
          ctx.restore();
        });
        if(t<dur) requestAnimationFrame(tick); else ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
      }
      tick();
    }

    init();
  </script>
</body>
</html>
